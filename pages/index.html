<!DOCTYPE html>
<html>
    <head>
        <title>Bestest Buy</title>
        <link rel="stylesheet" href="index.css">
        <style>
            .resize {
                width: 25%;
                height: auto;
            }
        </style>
    </head>
    
    <body>
        
        <img class="resize" src="images/logo.png">
        <h1>Welcome to Bestest Buy</h1>

        <br>

        <!-- This is just for navigation of the sample pages. -->
        <p1>This is the home page.</p1>
        <a href="/" class="button">Home</a>
        <a href="/accountPage" class="button">Accounts</a>
        <a href="/products" class="button">Browse Products</a>
        <a href="/admin" class="button">Admin</a>
        <a href="/staff" class="button">Employee</a>

        <br>
        <br>
        <p id="ManageUser"></p>
        
        <!-- This button calls buttonFunc in the script region below, and the <p> block has id demo so the js script
            can locate it -->
        <button onclick="buttonFunc()">Get Database Status</button>
        <p id="demo"></p>

        <!-- window.location.href gets current URL in brow, this is template for updating element in page
            with a response from the server, as opposed to the server completely overwriting the currently loaded
            page/response -->
        <script>
            const username =  document.cookie
            .split("; ")
            .find((row) => row.startsWith("username="))
            ?.split("=")[1];

            const userID = document.cookie
            .split("; ")
            .find((row) => row.startsWith("userID="))
            ?.split("=")[1];

            if(username === undefined || userID === undefined){
                document.getElementById('ManageUser').innerHTML = "Not signed in yet :(";
            }else {
                document.getElementById('ManageUser').innerHTML = "Welcome back " + username + "!";
            }

            var buttonFunc = function(){
                
                let testHTTP = {
                    method: "GET",
                    headers: {
                        "Content-Type": "text/plain"
                    }
                };
                
                fetch( window.location.href + "/dbStatus", testHTTP).then(
                    response => {
                        response.text().then(text => {
                            document.getElementById("demo").textContent = text;
                        })
                    }
                );
            };
        </script> <!-- Note that both fetch() and text() return promises, so they have to be "then"-ed and caught. -->
    </body>
</html>